# תחקיר: פער D1 – NinjaTrader vs SYSTEM ALPHA

## סיכום

| מדד | NinjaTrader | SYSTEM ALPHA |
|-----|-------------|--------------|
| **עסקאות** | 1,076 | 1,928 |
| **רווח כולל** | $42,910 | $55,925 |

**ממצא עיקרי:** חציית MACD מזוהה **בר אחד מוקדם יותר** במערכת שלנו – כנראה בשל חישוב MACD שונה.

---

## 1. השוואת העסקה הראשונה

### NinjaTrader
- **Entry:** 1/3/2023 8:41 AM @ 13096.75  
- **Exit:** 8:45 AM @ 13076.75 (Stop loss)  
- **מחיר כניסה 13096.75 = פתיחת בר 08:41** בנתוני ה-CSV

### SYSTEM ALPHA
- **Entry:** 1/3/2023 08:40 @ 13069.75  
- **Exit:** 08:41 @ 13109.75 (Take Profit)  
- **מחיר כניסה 13069.75 = פתיחת בר 08:40** בנתוני ה-CSV

### הנתונים ב-NQ_2023.csv (2023-01-03)

| זמן | Open | High | Low | Close |
|-----|------|------|-----|-------|
| 08:39 | 13073.0 | 13081.25 | 13063.0 | 13069.75 |
| 08:40 | 13069.75 | 13100.0 | 13068.5 | 13096.5 |
| 08:41 | 13096.75 | 13111.25 | 13084.25 | 13109.25 |

---

## 2. המסקנה

- NinjaTrader נכנס ב-**08:41** (open של 13096.75).
- המערכת שלנו נכנסת ב-**08:40** (open של 13069.75).

כלומר, במערכת שלנו חציית MACD מזוהה על בר **08:39**, ובנינג'ה טריידר על בר **08:40**.

לוגיקת OnBarClose:
- סיגנל כשהבר נסגר → ביצוע בפתיחת הבר הבא.
- סיגנל על בר 08:39 → כניסה ב-08:40.
- סיגנל על בר 08:40 → כניסה ב-08:41.

אצלנו הכניסה ב-08:40, כלומר הסיגנל על בר 08:39 – בר אחד מוקדם מנינג'ה טריידר.

---

## 3. מקור הפער – **נמצא וטופל**

### השוואת ערכים (Data Box מ-NinjaTrader)

| זמן | NT Macd | NT Avg | NT Diff | SA Macd | SA Avg | SA Diff |
|-----|---------|--------|---------|---------|--------|---------|
| 08:38 | -2.73 | -2.02 | -0.716 | -2.7347 | -2.0189 | -0.7158 |
| 08:39 | -1.96 | -2.01 | **+0.0438** | -1.9641 | -2.0079 | **+0.0438** |
| 08:40 | +0.796 | -1.45 | +2.24 | +0.7958 | -1.4472 | +2.2430 |

**מסקנה:** חישובי MACD **זהים** (הפערים מזעריים). הפער נובע מ**לוגיקת זיהוי החצייה** ב-D1.

### הבעיה: אינדקס שגוי ב-NinjaTrader

ב-D1 השתמשנו ב־`macdIndicator[0]` – ב-NinjaTrader המפתחר `[0]` מחזיר את **קו MACD** (הפלוט הראשון), לא את ה־**Histogram (Diff)**.

- **קו MACD חוצה 0** ב־08:40 (מ־-1.96 ל־+0.796)
- **Histogram חוצה 0** ב־08:39 (מ־-0.716 ל־+0.0438)

"MACD חוצה מעל Signal" = Histogram חוצה מעל 0. NinjaTrader בדק קו MACD מול 0 → זיהוי בר 08:40 → כניסה 08:41. המערכת שלנו בדק Histogram → זיהוי בר 08:39 → כניסה 08:40.

### התיקון

ב־D1.cs יש לעבור לגישה ל־Diff במפורש:
```csharp
return macdIndicator.Diff[1] <= 0 && macdIndicator.Diff[0] > 0;
```

---

## 5. סיכום מספרי

| מקור | עסקאות | רווח | עסקה 1 Entry |
|------|--------|------|--------------|
| NinjaTrader | 1,076 | $42,910 | 8:41 @ 13096.75 |
| SYSTEM ALPHA | 1,928 | $55,925 | 8:40 @ 13069.75 |

הפער נובע מזיהוי חציית MACD בר אחד מוקדם יותר במערכת שלנו, שמביא לכניסות שונות ולתוצאות שונות.
