# איך לעלות על הפער – מה צריך לעשות

## המטרה
להבין למה NinjaTrader מזהה חציית MACD בר אחד **אחרי** המערכת שלנו, ולסגור את הפער.

---

## מה צריך ממך

### אפשרות 1: ערכי MACD מנינג'ה טריידר (מומלץ)

צור אינדיקטור זמני או אסטרטגיה שמדפיסה ערכי MACD. הרץ על NQ 2023, גרף דקה, וצלם/ייצא את הפלט.

**קוד לדוגמה – הוסף ל-OnBarUpdate של אסטרטגיה או אינדיקטור:**
```csharp
if (Time[0].Date == new DateTime(2023, 1, 3) && Time[0].Hour == 8 && Time[0].Minute >= 35 && Time[0].Minute <= 45)
{
    Print(Time[0].ToString("MM/dd HH:mm") + " | Macd=" + MACD(12,26,9).Macd[0] + " Avg=" + MACD(12,26,9).Avg[0] + " Diff=" + MACD(12,26,9).Diff[0]);
}
```

או בדוק איך לגשת ל־Plots ב־NT8 (למשל `MACD(12,26,9).Values[0]`, `Values[1]`, `Values[2]`).

**צריך לקבל משהו בסגנון:**
```
01/03 08:35 | Macd=X.XX  Avg=Y.YY  Diff=Z.ZZ
01/03 08:36 | ...
01/03 08:37 | ...
01/03 08:38 | ...
01/03 08:39 | ...
01/03 08:40 | ...
01/03 08:41 | ...
```

שלח את הפלט ואפשר יהיה להשוות למה שהמערכת שלנו מחשבת.

---

### אפשרות 2: קוד מקור של MACD בנינג'ה טריידר 8

1. פתח NinjaScript Editor (Ctrl+Shift+N)
2. מצא את האינדיקטור **MACD**
3. העתק את הקוד (בעיקר `OnBarUpdate`, `Initialize`, אתחול EMA)
4. שלח את הקובץ או את החלקים הרלוונטיים

כך אפשר לשכפל בדיוק את החישוב.

---

### אפשרות 3: בדיקה מה `macdIndicator[0]` מחזיר

ב־D1.cs השתמשנו ב־`macdIndicator[0]` ו־`macdIndicator[1]` לצורך זיהוי חצייה.

צריך לוודא:
- האם `[0]` = קו MACD, קו Signal, או Histogram?
- האם ה־cross detection צריך להשתמש ב־`.Diff` במקום ב־`[0]`?

**בדיקה פשוטה:** הוסף Print ל־D1:
```csharp
if (CurrentBar >= 35 && Time[0].Date == new DateTime(2023, 1, 3) && Time[0].Hour == 8 && Time[0].Minute >= 38 && Time[0].Minute <= 42)
{
    Print(Time[0].ToString("HH:mm") + " [0]=" + macdIndicator[0] + " [1]=" + macdIndicator[1]);
}
```

שלח את הפלט כדי לראות אילו ערכים מתקבלים ב־`[0]` ו־`[1]`.

---

## מה אפשר לעשות פה בלי מידע ממך

1. לחשב ערכי MACD במערכת שלנו לברים 08:35–08:45 ב־1/3/2023 (לפי ה־CSV).
2. ליצור סקריפט שמדפיס/מייצא את הערכים האלה.
3. להשוות בינם לבין מה שתשלח מנינג'ה טריידר.

---

## סיכום – מה הכי עוזר

| עדיפות | מה לספק | למה זה עוזר |
|--------|----------|--------------|
| 1 | ערכי MACD/Avg/Diff ל־08:35–08:45 ב־1/3/2023 | השוואה ישירה של חישובים |
| 2 | קוד MACD מ־NinjaScript (OnBarUpdate + אתחול) | התאמת האלגוריתם בדיוק |
| 3 | פלט Print של `macdIndicator[0]` ו־`[1]` | הבהרה מה נמדד – MACD, Signal או Histogram |

עם 1 או 2 ניתן יהיה להתאים את החישוב בדיוק ולסגור את הפער.

---

## ערכי SYSTEM ALPHA (להשוואה)

הרץ: `python scripts/export_macd_values.py NQ_2023.csv`

**ערכינו ל-2023-01-03 08:35–08:45:**

| זמן  | Macd    | Avg(Signal) | Diff(Hist) | Cross>0?      |
|------|---------|-------------|------------|---------------|
| 08:38| -2.7347 | -2.0189     | -0.7158    |               |
| 08:39| -1.9641 | -2.0079     | **+0.0438**| ← CROSS HERE  |
| 08:40| +0.7958 | -1.4472     | +2.2430    |               |
| 08:41| +3.9662 | -0.3645     | +4.3307    |               |

אצלנו ה-Histogram חוצה מעל 0 **בבר 08:39**. NinjaTrader נכנס ב-08:41, כלומר אצלם החצייה כנראה **בבר 08:40**. השווה את הערכים שלך לאלה.
